(function(e){function t(t){for(var a,i,s=t[0],c=t[1],l=t[2],d=0,f=[];d<s.length;d++)i=s[d],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&f.push(r[i][0]),r[i]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);u&&u(t);while(f.length)f.shift()();return o.push.apply(o,l||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],a=!0,s=1;s<n.length;s++){var c=n[s];0!==r[c]&&(a=!1)}a&&(o.splice(t--,1),e=i(i.s=n[0]))}return e}var a={},r={app:0},o=[];function i(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=a,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(n,a,function(t){return e[t]}.bind(null,a));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/thef2e-2019/w8-storage/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=c;o.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"29e1":function(e,t,n){"use strict";var a=n("3044"),r=n.n(a);r.a},3044:function(e,t,n){},"458e":function(e,t,n){"use strict";var a=n("57c2"),r=n.n(a);r.a},"56d7":function(e,t,n){"use strict";n.r(t);n("cadf"),n("551c"),n("f751"),n("097d");var a=n("2b0e"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app",on:{click:e.clickHandler}},[n("FileList"),n("Loading")],1)},o=[],i=(n("7f7f"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"fileList"},[n("div",{staticClass:"nav"},[e._m(0),n("label",[n("input",{ref:"file",attrs:{type:"file"},on:{change:e.changeHandler}}),e._v("上傳檔案\n        ")]),n("a",{directives:[{name:"show",rawName:"v-show",value:!e.id,expression:"!id"}],attrs:{href:""},on:{click:function(t){return t.preventDefault(),e.newFolder(t)}}},[e._v("新增資料夾")])]),n("div",{staticClass:"content"},[n("div",{staticClass:"top"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.searchText,expression:"searchText"}],staticClass:"search",attrs:{type:"text",placeholder:"搜尋您的檔案"},domProps:{value:e.searchText},on:{input:function(t){t.target.composing||(e.searchText=t.target.value)}}})]),n("div",{staticClass:"list"},[n("div",{directives:[{name:"show",rawName:"v-show",value:e.folders,expression:"folders"}],staticClass:"list-row"},[n("p",{staticClass:"list-title"},[e._v("資料夾")]),n("ul",e._l(e.folders,function(t,a){return n("li",{key:a,attrs:{"data-del-key":"/folders/"+a},on:{contextmenu:function(t){return t.preventDefault(),e.showMenu(t)},dblclick:function(t){return t.preventDefault(),e.enterFolder(a)}}},[e._v(e._s(a))])}),0)]),n("div",{directives:[{name:"show",rawName:"v-show",value:e.files.length,expression:"files.length"}],staticClass:"list-row"},[n("p",{staticClass:"list-title"},[e._v("檔案：")]),n("ul",e._l(e.files,function(t){return n("li",{key:t.createTime,attrs:{"data-del-key":t.key,"data-del-name":t.name,"data-dl-name":t.name,"data-dl-ulname":t.uploadName},on:{contextmenu:function(t){return t.preventDefault(),e.showMenu(t)}}},[e._v(e._s(t.uploadName))])}),0)])])]),n("MouseMenu",{attrs:{menuPos:e.menuPos,links:e.menuLinks},on:{deleteFile:e.deleteFile,download:e.download}})],1)}),s=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("h1",[a("img",{attrs:{src:n("e347"),alt:"Cloud"}})])}],c=(n("8e6e"),n("456d"),n("ac6a"),n("28a5"),n("bd86")),l=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.showMenu?n("div",{staticClass:"menu",style:{top:e.menuPos.y+"px",left:e.menuPos.x+"px"}},[e.links.dlName?n("a",{attrs:{href:""},on:{click:function(t){return t.preventDefault(),e.download(t)}}},[e._v("下載")]):e._e(),n("a",{attrs:{href:""},on:{click:function(t){return t.preventDefault(),e.deleteFile(t)}}},[e._v("刪除")])]):e._e()},u=[],d={props:{menuPos:{type:Object},links:{type:Object}},computed:{showMenu:function(){return this.$store.state.showMenu}},methods:{download:function(){this.$emit("download",this.links)},deleteFile:function(){this.$emit("deleteFile",this.links)}}},f=d,p=(n("458e"),n("2877")),h=Object(p["a"])(f,l,u,!1,null,"98d448c6",null),m=h.exports;function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(n,!0).forEach(function(t){Object(c["a"])(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var b,w,y,O={apiKey:"AIzaSyCFQrK8G78IGKJ0cwHYez1P3WSOQyDNA3c",authDomain:"test-abea4.firebaseapp.com",databaseURL:"https://test-abea4.firebaseio.com",projectId:"test-abea4",storageBucket:"test-abea4.appspot.com",messagingSenderId:"942650617694",appId:"1:942650617694:web:6d938b4bdd578ac8"},x={components:{MouseMenu:m},data:function(){return{rootFiles:null,searchText:"",progress:0,menuPos:{x:0,y:0},menuLinks:{delKey:"",delName:"",dlName:"",dlUlname:""}}},computed:{id:function(){return this.$route.params.id},files:function(){var e=this,t=[];for(var n in this.rootFiles)if(this.rootFiles.hasOwnProperty(n)&&"folders"!==n&&"README.md"!==this.rootFiles[n].uploadName){var a=g({key:n},this.rootFiles[n]);t.push(a)}return this.searchText?t.filter(function(t){return-1!==t.uploadName.indexOf(e.searchText)}):t},folders:function(){var e;for(var t in this.rootFiles)this.rootFiles.hasOwnProperty(t)&&"folders"===t&&(e=this.rootFiles[t]);if(this.searchText){var n={};for(var a in e)e.hasOwnProperty(a)&&-1!==a.indexOf(this.searchText)&&(n[a]=e[a]);return n}return e}},watch:{id:function(e){this.getList()},rootFiles:function(e){e&&this.$store.commit("updateLoadingState",!1)}},methods:{init:function(){0===firebase.apps.length&&firebase.initializeApp(O),b=firebase.storage()},getList:function(){var e=this;this.$store.commit("updateLoadingState",!0),w=this.id?firebase.database().ref("w8/folders/".concat(this.id)):firebase.database().ref("w8"),w.on("value",function(t){e.rootFiles=t.val(),null===e.rootFiles&&e.$store.commit("updateLoadingState",!1)})},changeHandler:function(e){var t=this;this.$store.commit("updateLoadingState",!0);var n=e.target.files.item(0),a=(new Date).getTime(),r=n.name.split(".")[n.name.split(".").length-1];y=this.id?b.ref("w8/folders/".concat(this.id,"/").concat(a,".").concat(r)):b.ref("w8/".concat(a,".").concat(r));var o=y.put(n);o.on("state_changed",function(e){return t.progress=e.bytesTransferred/e.totalBytes*100},function(e){return console.log("上傳失敗")},function(e){console.log("上傳成功"),t.submitHandler("".concat(a,".").concat(r),n.name)})},newFolder:function(){var e=this,t=prompt("資料夾名稱");if(t){w=firebase.database().ref("w8/folders/".concat(t));var n="README.md",a=b.ref("w8/folders/".concat(t,"/").concat(n)),r=new File([""],"README.md");a.put(r).then(function(t){e.submitHandler(n,r.name)})}},submitHandler:function(e,t){w.push({name:e,uploadName:t,createTime:(new Date).getTime()}),this.getList(),this.$refs.file.value="",this.$store.commit("updateLoadingState",!1)},deleteFile:function(e){var t,n=e.delKey,a=e.delName;confirm("確定刪除？")&&(a=a||n,t=this.id?b.ref("w8/folders/".concat(this.id,"/").concat(a)):b.ref("w8/".concat(a)),t.listAll().then(function(e){var r=e.items;r.length>0?r.forEach(function(e){t=b.ref("w8/".concat(a,"/").concat(e.name)),t.delete()}):t.delete(),w.child(n).remove()}))},download:function(e){var t=e.dlName,n=e.dlUlname;y=this.id?b.ref("w8/folders/".concat(this.id,"/").concat(t)):b.ref("w8/".concat(t)),y.getDownloadURL().then(function(e){fetch(e).then(function(e){return e.blob()}).then(function(e){var t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download=n,a.style.display="none",document.body.appendChild(a),a.click(),URL.revokeObjectURL(e),document.body.removeChild(a)})})},enterFolder:function(e){this.$router.push({path:"folders/".concat(e)})},showMenu:function(e){this.$store.commit("toggleMenu",!0),this.$set(this.menuPos,"x",e.pageX),this.$set(this.menuPos,"y",e.pageY),this.$set(this.menuLinks,"delKey",e.target.dataset.delKey),this.$set(this.menuLinks,"delName",e.target.dataset.delName),this.$set(this.menuLinks,"dlName",e.target.dataset.dlName),this.$set(this.menuLinks,"dlUlname",e.target.dataset.dlUlname)}},created:function(){this.init(),this.getList()}},_=x,k=(n("e762"),Object(p["a"])(_,i,s,!1,null,"95cb7e5a",null)),j=k.exports,P=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("transition",{attrs:{name:"slide-fade"}},[e.uploading?n("div",{staticClass:"cover"},[n("img",{staticClass:"loading",attrs:{src:"loading.svg",alt:""}})]):e._e()])},L=[],$={computed:{uploading:function(){return this.$store.state.loading}}},F=$,M=(n("29e1"),Object(p["a"])(F,P,L,!1,null,"c4ab0b5e",null)),N=M.exports,C={components:{FileList:j,Loading:N},computed:{componentId:function(){return this.$store.state.route.name}},methods:{clickHandler:function(e){"menu"!==e.target.className&&this.$store.commit("toggleMenu",!1)}}},D=C,S=(n("5c0b"),Object(p["a"])(D,r,o,!1,null,null,null)),T=S.exports,E=n("8c4f");a["a"].use(E["a"]);var U=new E["a"]({routes:[{path:"/folders/:id",name:"folder"},{path:"/",name:"home"}]}),R=n("2f62");a["a"].use(R["a"]);var H=new R["a"].Store({state:{loading:!1,showMenu:!1},mutations:{updateLoadingState:function(e,t){e.loading=t},toggleMenu:function(e,t){e.showMenu=t}}});a["a"].config.productionTip=!1,new a["a"]({router:U,store:H,render:function(e){return e(T)}}).$mount("#app")},"57c2":function(e,t,n){},"5c0b":function(e,t,n){"use strict";var a=n("e332"),r=n.n(a);r.a},e332:function(e,t,n){},e347:function(e,t,n){e.exports=n.p+"img/logo.bc3a6621.svg"},e762:function(e,t,n){"use strict";var a=n("ea45"),r=n.n(a);r.a},ea45:function(e,t,n){}});
//# sourceMappingURL=app.0acdd46a.js.map